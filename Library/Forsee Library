-- Forsee Library - UPDATED with Startup Config System

local lib = {RainbowColorValue = 0, HueSelectionPosition = 0}
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local LocalPlayer = game:GetService("Players").LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local PresetColor = Color3.fromRGB(44, 120, 224)
local CloseBind = Enum.KeyCode.RightControl

-- Config saving system with persistent storage
local HttpService = game:GetService("HttpService")
local ConfigFolder = "Forsee Library"
local ConfigSubfolder = "Default"
local ConfigElements = {}
local CurrentConfigName = ""
local StartupSettingsFile = ConfigFolder .. "/startup_settings.json" -- New file for startup settings

-- Global element ID counter
local globalElementIdCounter = 0

-- Notification management
local CurrentNotification = nil

-- Track UI state
local uitoggled = false
local uiElementStates = {}

-- Create config folder if it doesn't exist
if not isfolder(ConfigFolder) then
    makefolder(ConfigFolder)
end

-- Function to get full config path
local function GetFullConfigPath()
    local path = ConfigFolder .. "/" .. ConfigSubfolder
    if not isfolder(path) then
        makefolder(path)
    end
    return path
end

function lib:SetConfigFolder(name)
    ConfigSubfolder = name or "Default"
end

local function SaveConfig(name)
    if not name or name == "" then
        return false, "Config name cannot be empty"
    end

    local configData = {
        PresetColor = {R = PresetColor.R, G = PresetColor.G, B = PresetColor.B},
        CloseBind = CloseBind.Name,
        Elements = {}
    }

    for id, element in pairs(ConfigElements) do
        if element.Type == "Toggle" then
            configData.Elements[id] = {Type = "Toggle", Value = element.Value}
        elseif element.Type == "Slider" then
            configData.Elements[id] = {Type = "Slider", Value = element.Value}
        elseif element.Type == "Dropdown" then
            configData.Elements[id] = {Type = "Dropdown", Value = element.Value}
        elseif element.Type == "Textbox" then
            configData.Elements[id] = {Type = "Textbox", Value = element.Value}
        elseif element.Type == "Bind" then
            configData.Elements[id] = {Type = "Bind", Value = element.Value}
        end
    end

    local success, err = pcall(function()
        writefile(GetFullConfigPath() .. "/" .. name .. ".json", HttpService:JSONEncode(configData))
    end)

    if success then
        return true, "Config '" .. name .. "' saved successfully!"
    else
        return false, "Failed to save config: " .. tostring(err)
    end
end

local function LoadConfig(name)
    if not name or name == "" then
        return false, "Config name cannot be empty"
    end
    local filePath = GetFullConfigPath() .. "/" .. name .. ".json"
    if not isfile(filePath) then
        return false, "Config '" .. name .. "' not found"
    end
    local success, result = pcall(function()
        return HttpService:JSONDecode(readfile(filePath))
    end)
    if not success then
        return false, "Failed to load config: " .. tostring(result)
    end
    local config = result
    if config.PresetColor then
        PresetColor = Color3.new(config.PresetColor.R, config.PresetColor.G, config.PresetColor.B)
        if lib.ChangePresetColor then
            lib:ChangePresetColor(PresetColor)
        end
    end
    if config.CloseBind then
        for _, kc in pairs(Enum.KeyCode:GetEnumItems()) do
            if kc.Name == config.CloseBind then
                CloseBind = kc
                break
            end
        end
    end
    if config.Elements then
        for id, data in pairs(config.Elements) do
            if ConfigElements[id] and ConfigElements[id].LoadValue then
                ConfigElements[id].LoadValue(data.Value)
            end
        end
    end
    return true, "Config '" .. name .. "' loaded successfully!"
end

local function DeleteConfig(name)
    if not name or name == "" then
        return false, "Config name cannot be empty"
    end
    local filePath = GetFullConfigPath() .. "/" .. name .. ".json"
    if not isfile(filePath) then
        return false, "Config '" .. name .. "' not found"
    end
    local success, err = pcall(function()
        delfile(filePath)
    end)
    if success then
        return true, "Config '" .. name .. "' deleted successfully!"
    else
        return false, "Failed to delete config: " .. tostring(err)
    end
end

local function GetAllConfigs()
    local configs = {}
    local path = GetFullConfigPath()
    local success, files = pcall(listfiles, path)
    if success then
        for _, file in pairs(files) do
            local fileName = file:match("([^/]+)%.json$")
            if fileName then
                table.insert(configs, fileName)
            end
        end
    end
    return configs
end

-- NEW: Functions to handle startup config settings
local function LoadStartupSettings()
    if isfile(StartupSettingsFile) then
        local success, data = pcall(function()
            return HttpService:JSONDecode(readfile(StartupSettingsFile))
        end)
        if success and type(data) == "table" then
            return data
        end
    end
    -- Return default settings if file doesn't exist or is corrupt
    return {Enabled = false, ConfigName = nil}
end

local function SaveStartupSettings(data)
    pcall(function()
        writefile(StartupSettingsFile, HttpService:JSONEncode(data))
    end)
end

-- NEW: Function to apply the startup config at the beginning of the script
function lib:ApplyStartupConfig()
    local settings = LoadStartupSettings()
    if settings.Enabled and settings.ConfigName then
        -- Wait a moment for the library to be fully initialized
        wait(0.2)
        local success, msg = LoadConfig(settings.ConfigName)
        if success then
            print("Forsee: Startup config '" .. settings.ConfigName .. "' loaded successfully.")
        else
            print("Forsee: Failed to load startup config '" .. settings.ConfigName .. "'. Reason: " .. msg)
        end
    end
end

local ui = Instance.new("ScreenGui")
ui.Name = "ui"
ui.Parent = game.CoreGui
ui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local isMobile = UserInputService.TouchEnabled and not UserInputService.MouseEnabled

coroutine.wrap(function()
    while wait() do
        lib.RainbowColorValue = (lib.RainbowColorValue + 1 / 255) % 1
        lib.HueSelectionPosition = (lib.HueSelectionPosition + 1) % 80
    end
end)()

local function MakeDraggable(topbarobject, object)
    local Dragging, DragInput, DragStart, StartPosition
    topbarobject.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Dragging, DragStart, StartPosition = true, input.Position, object.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    Dragging = false
                end
            end)
        end
    end)
    topbarobject.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            DragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == DragInput and Dragging then
            object.Position = UDim2.new(StartPosition.X.Scale, StartPosition.X.Offset + (input.Position.X - DragStart.X), StartPosition.Y.Scale, StartPosition.Y.Offset + (input.Position.Y - DragStart.Y))
        end
    end)
end

local function FadeOutUI(main)
    local fadeTime = 0.3
    local tweens = {}
    uiElementStates = {}
    local allObjects = main:GetDescendants()
    table.insert(allObjects, 1, main)
    for _, obj in ipairs(allObjects) do
        if obj:IsA("GuiObject") then
            local stateToSave, propsToFade = {}, {}
            if pcall(function() return obj.BackgroundTransparency end) then stateToSave.BackgroundTransparency = obj.BackgroundTransparency; propsToFade.BackgroundTransparency = 1 end
            if pcall(function() return obj.TextTransparency end) then stateToSave.TextTransparency = obj.TextTransparency; propsToFade.TextTransparency = 1 end
            if pcall(function() return obj.ImageTransparency end) then stateToSave.ImageTransparency = obj.ImageTransparency; propsToFade.ImageTransparency = 1 end
            if obj:IsA("ScrollingFrame") then stateToSave.ScrollBarImageTransparency = obj.ScrollBarImageTransparency; obj.ScrollBarImageTransparency = 1 end
            if next(propsToFade) or stateToSave.ScrollBarImageTransparency ~= nil then
                uiElementStates[obj] = stateToSave
                if next(propsToFade) then
                    table.insert(tweens, TweenService:Create(obj, TweenInfo.new(fadeTime, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), propsToFade))
                end
            end
        end
    end
    for _, tween in ipairs(tweens) do tween:Play() end
    wait(fadeTime)
    main.Visible = false
end

local function FadeInUI(main)
    main.Visible = true
    local fadeTime = 0.3
    local tweens = {}
    for obj, storedState in pairs(uiElementStates) do
        if obj and obj.Parent then
            if storedState.BackgroundTransparency ~= nil then obj.BackgroundTransparency = 1 end
            if storedState.TextTransparency ~= nil then obj.TextTransparency = 1 end
            if storedState.ImageTransparency ~= nil then obj.ImageTransparency = 1 end
            if storedState.ScrollBarImageTransparency ~= nil then obj.ScrollBarImageTransparency = 1 end
            table.insert(tweens, TweenService:Create(obj, TweenInfo.new(fadeTime, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), storedState))
        end
    end
    for _, tween in ipairs(tweens) do tween:Play() end
end

function lib:Window(text, preset, closebind)
    CloseBind = closebind or Enum.KeyCode.RightControl
    PresetColor = preset or Color3.fromRGB(44, 120, 224)
    local fs = false
    local keybindConnection = nil

    local Main = Instance.new("Frame", ui)
    Main.Name = "Main"
    Main.AnchorPoint = Vector2.new(0.5, 0.5)
    Main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Main.BorderSizePixel = 0
    Main.Position = UDim2.new(0.5, 0, 0.5, 0)
    Main.Size = UDim2.new(0, 560, 0, 329)
    Main.ClipsDescendants = true
    Main.Visible = false
    Main.BackgroundTransparency = 0
    
    local MainCorner = Instance.new("UICorner", Main)
    MainCorner.CornerRadius = UDim.new(0, 8)

    local DragFrame = Instance.new("Frame", Main)
    DragFrame.Name = "DragFrame"
    DragFrame.BackgroundTransparency = 1
    DragFrame.Size = UDim2.new(0, 560, 0, 50)

    local Title = Instance.new("TextLabel", Main)
    Title.Name = "Title"
    Title.BackgroundTransparency = 1
    Title.Position = UDim2.new(0.034, 0, 0.026, 0)
    Title.Size = UDim2.new(0, 200, 0, 30)
    Title.Font = Enum.Font.GothamSemibold
    Title.Text = text
    Title.TextColor3 = Color3.fromRGB(120, 120, 120)
    Title.TextSize = 14
    Title.TextXAlignment = Enum.TextXAlignment.Left

    local ButtonsContainer = Instance.new("Frame", Main)
    ButtonsContainer.BackgroundTransparency = 1
    ButtonsContainer.Position = UDim2.new(0.88, 0, 0.026, 0)
    ButtonsContainer.Size = UDim2.new(0, 70, 0, 30)

    local CloseBtn = Instance.new("TextButton", ButtonsContainer)
    CloseBtn.Name = "CloseBtn"
    CloseBtn.BackgroundTransparency = 1
    CloseBtn.Position = UDim2.new(0.5, 0, 0, 0)
    CloseBtn.Size = UDim2.new(0, 30, 0, 30)
    CloseBtn.Font = Enum.Font.GothamSemibold
    CloseBtn.Text = "x"
    CloseBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
    CloseBtn.TextSize = 16
    CloseBtn.MouseEnter:Connect(function() TweenService:Create(CloseBtn, TweenInfo.new(.2), {TextColor3 = Color3.fromRGB(255, 100, 100)}):Play() end)
    CloseBtn.MouseLeave:Connect(function() TweenService:Create(CloseBtn, TweenInfo.new(.2), {TextColor3 = Color3.fromRGB(150, 150, 150)}):Play() end)
    CloseBtn.MouseButton1Click:Connect(function() FadeOutUI(Main); wait(0.35); ui:Destroy() end)

    local TitleSeparator = Instance.new("Frame", Main)
    TitleSeparator.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    TitleSeparator.BorderSizePixel = 0
    TitleSeparator.Position = UDim2.new(0.034, 0, 0.137, 0)
    TitleSeparator.Size = UDim2.new(0, 520, 0, 1)

    local TabHold = Instance.new("Frame", Main)
    TabHold.Name = "TabHold"
    TabHold.BackgroundTransparency = 1
    TabHold.Position = UDim2.new(0.034, 0, 0.167, 0)
    TabHold.Size = UDim2.new(0, 107, 0, 254)
    
    local TabHoldLayout = Instance.new("UIListLayout", TabHold)
    TabHoldLayout.Padding = UDim.new(0, 16)

    local SeparatorLine = Instance.new("Frame", Main)
    SeparatorLine.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    SeparatorLine.BorderSizePixel = 0
    SeparatorLine.Position = UDim2.new(0.28, 0, 0.167, 0)
    SeparatorLine.Size = UDim2.new(0, 1, 0, 254)

    local TabFolder = Instance.new("Folder", Main)
    TabFolder.Name = "TabFolder"

    delay(0.1, function() 
        FadeOutUI(Main) 
        wait(0.4)
        uitoggled = false
        FadeInUI(Main) 
    end)
    MakeDraggable(DragFrame, Main)

    local function UpdateKeybindConnection()
        if keybindConnection then keybindConnection:Disconnect() end
        keybindConnection = UserInputService.InputBegan:Connect(function(io, p)
            if io.KeyCode == CloseBind and not p then
                uitoggled = not uitoggled
                if uitoggled then
                    FadeOutUI(Main)
                    ui.Enabled = false
                else
                    FadeInUI(Main)
                    ui.Enabled = true
                end
            end
        end)
    end
    UpdateKeybindConnection()
    Main.Destroying:Connect(function() if keybindConnection then keybindConnection:Disconnect() end end)

    function lib:ChangePresetColor(toch)
        PresetColor = toch
        for _, tab in pairs(TabFolder:GetChildren()) do
            for _, element in pairs(tab:GetDescendants()) do
                if element.Name == "FrameToggle3" or element.Name == "CurrentValueFrame" or element.Name == "TabBtnIndicator" or element.Name == "FrameRainbowToggle3" then
                    element.BackgroundColor3 = toch
                elseif element.Name == "SlideCircle" then
                    element.ImageColor3 = toch
                end
            end
        end
    end

    function lib:Notification(title, desc, buttons)
        if CurrentNotification then CurrentNotification:Destroy(); CurrentNotification = nil end
        local NotificationHold = Instance.new("TextButton", Main)
        CurrentNotification = NotificationHold
        NotificationHold.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        NotificationHold.BackgroundTransparency = 0.7
        NotificationHold.Size = UDim2.new(1, 0, 1, 0)
        NotificationHold.ZIndex = 10
        NotificationHold.Text = ""

        local NotificationFrame = Instance.new("Frame", NotificationHold)
        NotificationFrame.AnchorPoint = Vector2.new(0.5, 0.5)
        NotificationFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        NotificationFrame.ClipsDescendants = true
        NotificationFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        NotificationFrame.Size = UDim2.new(0, 300, 0, 180)
        NotificationFrame.ZIndex = 11

        local NotificationCorner = Instance.new("UICorner", NotificationFrame)
        NotificationCorner.CornerRadius = UDim.new(0, 8)

        local NotificationTitle = Instance.new("TextLabel", NotificationFrame)
        NotificationTitle.BackgroundTransparency = 1
        NotificationTitle.Position = UDim2.new(0.05, 0, 0.05, 0)
        NotificationTitle.Size = UDim2.new(0.9, 0, 0, 26)
        NotificationTitle.Font = Enum.Font.GothamBold
        NotificationTitle.Text = title
        NotificationTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
        NotificationTitle.TextSize = 16
        NotificationTitle.TextXAlignment = Enum.TextXAlignment.Left
        NotificationTitle.ZIndex = 12

        local NotificationDesc = Instance.new("TextLabel", NotificationFrame)
        NotificationDesc.BackgroundTransparency = 1
        NotificationDesc.Position = UDim2.new(0.05, 0, 0.2, 0)
        NotificationDesc.Size = UDim2.new(0.9, 0, 0, 70)
        NotificationDesc.Font = Enum.Font.Gotham
        NotificationDesc.Text = desc
        NotificationDesc.TextColor3 = Color3.fromRGB(200, 200, 200)
        NotificationDesc.TextSize = 14
        NotificationDesc.TextWrapped = true
        NotificationDesc.TextXAlignment = Enum.TextXAlignment.Left
        NotificationDesc.TextYAlignment = Enum.TextYAlignment.Top
        NotificationDesc.ZIndex = 12

        local ButtonContainer = Instance.new("Frame", NotificationFrame)
        ButtonContainer.BackgroundTransparency = 1
        ButtonContainer.Position = UDim2.new(0.05, 0, 0.65, 0)
        ButtonContainer.Size = UDim2.new(0.9, 0, 0, 50)
        ButtonContainer.ZIndex = 12

        local ButtonLayout = Instance.new("UIListLayout", ButtonContainer)
        ButtonLayout.FillDirection = Enum.FillDirection.Horizontal
        ButtonLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
        ButtonLayout.Padding = UDim.new(0, 10)

        local function CloseNotification()
            if NotificationHold and NotificationHold.Parent then NotificationHold:Destroy() end
            CurrentNotification = nil
        end
        if type(buttons) == "string" then
            local Btn = Instance.new("TextButton", ButtonContainer)
            Btn.BackgroundColor3 = Color3.fromRGB(34, 34, 34)
            Btn.Size = UDim2.new(0, 120, 0, 35)
            Btn.Font = Enum.Font.Gotham
            Btn.Text = buttons
            Btn.TextColor3 = Color3.fromRGB(255, 255, 255)
            Btn.TextSize = 14
            Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 6)
            Btn.MouseButton1Click:Connect(CloseNotification)
        elseif type(buttons) == "table" then
            for _, btnData in ipairs(buttons) do
                local Btn = Instance.new("TextButton", ButtonContainer)
                Btn.BackgroundColor3 = btnData.Color or Color3.fromRGB(34, 34, 34)
                Btn.Size = UDim2.new(0, 120, 0, 35)
                Btn.Font = Enum.Font.Gotham
                Btn.Text = btnData.Text
                Btn.TextColor3 = Color3.fromRGB(255, 255, 255)
                Btn.TextSize = 14
                Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 6)
                Btn.MouseButton1Click:Connect(function()
                    if btnData.Callback then pcall(btnData.Callback) end
                    CloseNotification()
                end)
            end
        end
    end

    function lib:ConfigTab(tab)
        local selectedConfig = ""
        local configDropdown
        tab:Textbox("New Config Name", false, function(text) CurrentConfigName = text end)
        tab:Button("Save Config", function()
            if CurrentConfigName and CurrentConfigName ~= "" then
                local s, m = SaveConfig(CurrentConfigName)
                lib:Notification(s and "Success" or "Error", m, "Okay")
                if s and configDropdown then wait(0.1); configDropdown.Refresh() end
            else
                lib:Notification("Error", "Please enter a config name first", "Okay")
            end
        end)
        tab:Label("Load/Delete Configs")
        configDropdown = tab:Dropdown("Select Config", GetAllConfigs, function(selected) selectedConfig = selected end)
        tab:Button("Load Config", function()
            if selectedConfig and selectedConfig ~= "No Configs" then
                local s, m = LoadConfig(selectedConfig)
                lib:Notification(s and "Success" or "Error", m, "Okay")
            else
                lib:Notification("Error", "Please select a config first", "Okay")
            end
        end)
        tab:Button("Delete Config", function()
            if selectedConfig and selectedConfig ~= "No Configs" then
                lib:Notification("Confirm Deletion", "Are you sure you want to delete '" .. selectedConfig .. "'?", {
                    {Text = "Cancel"},
                    {Text = "Delete", Color = Color3.fromRGB(200, 50, 50), Callback = function()
                        local s, m = DeleteConfig(selectedConfig)
                        wait(0.2)
                        lib:Notification(s and "Success" or "Error", m, "Okay")
                        if s and configDropdown then wait(0.1); configDropdown.Refresh(); selectedConfig = "" end
                    end}
                })
            else
                lib:Notification("Error", "Please select a config first", "Okay")
            end
        end)
    end
    
    function lib:StartupConfigTab(tab)
        local startupSettings = LoadStartupSettings()
        local function updateAndSave()
            SaveStartupSettings(startupSettings)
        end
        tab:Toggle("Enable Startup Config", startupSettings.Enabled, function(state)
            startupSettings.Enabled = state
            updateAndSave()
        end)
        local startupDropdown = tab:Dropdown("Startup Config", GetAllConfigs, function(selected)
            if selected ~= "No Configs" then
                startupSettings.ConfigName = selected
                updateAndSave()
                startupDropdown.SetText("Startup Config - " .. selected)
            end
        end)
        
        if startupSettings.ConfigName and startupSettings.ConfigName ~= "" then
            startupDropdown.SetText("Startup Config - " .. startupSettings.ConfigName)
        else
            startupDropdown.SetText("Startup Config")
        end
    end

    function lib:SetToggleKey(key) CloseBind = key; UpdateKeybindConnection(); lib:Notification("Keybind Updated", "UI toggle key has been set to: " .. key.Name, "Okay") end
    function lib:GetToggleKey() return CloseBind end

    local tabhold = {}
    function tabhold:Tab(text)
        local TabBtn = Instance.new("TextButton", TabHold); TabBtn.Name = "TabBtn"; TabBtn.BackgroundTransparency = 1; TabBtn.Size = UDim2.new(0, 107, 0, 28); TabBtn.Text = ""
        local TabTitle = Instance.new("TextLabel", TabBtn); TabTitle.Name = "TabTitle"; TabTitle.BackgroundTransparency = 1; TabTitle.Size = UDim2.new(1, 0, 1, 0); TabTitle.Font = Enum.Font.Gotham; TabTitle.Text = text; TabTitle.TextColor3 = Color3.fromRGB(150, 150, 150); TabTitle.TextSize = 14; TabTitle.TextXAlignment = Enum.TextXAlignment.Left
        local TabBtnIndicator = Instance.new("Frame", TabBtn); TabBtnIndicator.Name = "TabBtnIndicator"; TabBtnIndicator.BackgroundColor3 = PresetColor; TabBtnIndicator.BorderSizePixel = 0; TabBtnIndicator.Position = UDim2.new(0, 0, 1, 0); TabBtnIndicator.Size = UDim2.new(0, 0, 0, 2)
        Instance.new("UICorner", TabBtnIndicator)
        
        local Tab = Instance.new("ScrollingFrame", TabFolder); Tab.Name = "Tab"; Tab.Active = true; Tab.BackgroundTransparency = 1; Tab.BorderSizePixel = 0; Tab.Position = UDim2.new(0.314, 0, 0.167, 0); Tab.Size = UDim2.new(0, 373, 0, 254); Tab.CanvasSize = UDim2.new(0, 0, 0, 0); Tab.ScrollBarThickness = 3; Tab.Visible = false
        local TabLayout = Instance.new("UIListLayout", Tab); TabLayout.Padding = UDim.new(0, 6)

        if not fs then fs = true; TabBtnIndicator.Size = UDim2.new(0, #text * 8.5, 0, 2); TabTitle.TextColor3 = Color3.fromRGB(255, 255, 255); Tab.Visible = true end

        TabBtn.MouseButton1Click:Connect(function()
            for _, v in pairs(TabFolder:GetChildren()) do v.Visible = false end; Tab.Visible = true
            for _, v in pairs(TabHold:GetChildren()) do if v.Name == "TabBtn" then v.TabBtnIndicator:TweenSize(UDim2.new(0, 0, 0, 2), "Out", "Quart", 0.2, true); TweenService:Create(v.TabTitle, TweenInfo.new(0.3), {TextColor3 = Color3.fromRGB(150, 150, 150)}):Play() end end
            TabBtnIndicator:TweenSize(UDim2.new(0, #text * 8.5, 0, 2), "Out", "Quart", 0.2, true); TweenService:Create(TabTitle, TweenInfo.new(0.3), {TextColor3 = Color3.fromRGB(255, 255, 255)}):Play()
        end)
        
        local tabcontent = {}
        
        function tabcontent:Button(text, callback)
            local Button = Instance.new("TextButton", Tab)
            Button.Name = "Button"
            Button.BackgroundColor3 = Color3.fromRGB(34, 34, 34)
            Button.Size = UDim2.new(0, 363, 0, 42)
            Button.AutoButtonColor = false
            Button.Text = ""

            local ButtonCorner = Instance.new("UICorner", Button)
            ButtonCorner.CornerRadius = UDim.new(0, 6)

            local ButtonTitle = Instance.new("TextLabel", Button)
            ButtonTitle.Name = "ButtonTitle"
            ButtonTitle.BackgroundTransparency = 1
            ButtonTitle.Position = UDim2.new(0.035, 0, 0, 0)
            ButtonTitle.Size = UDim2.new(0, 187, 0, 42)
            ButtonTitle.Font = Enum.Font.Gotham
            ButtonTitle.Text = text
            ButtonTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
            ButtonTitle.TextSize = 14
            ButtonTitle.TextXAlignment = Enum.TextXAlignment.Left

            Button.MouseEnter:Connect(function() TweenService:Create(Button, TweenInfo.new(.2), {BackgroundColor3 = Color3.fromRGB(37, 37, 37)}):Play() end)
            Button.MouseLeave:Connect(function() TweenService:Create(Button, TweenInfo.new(.2), {BackgroundColor3 = Color3.fromRGB(34, 34, 34)}):Play() end)
            Button.MouseButton1Click:Connect(function() pcall(callback) end)
            
            Tab.CanvasSize = UDim2.new(0, 0, 0, TabLayout.AbsoluteContentSize.Y)
        end

        function tabcontent:Toggle(text, default, callback)
            globalElementIdCounter = globalElementIdCounter + 1
            local elementId = "Toggle_" .. globalElementIdCounter
            local toggled = default or false

            local Toggle = Instance.new("TextButton", Tab)
            Toggle.Name = "Toggle"
            Toggle.BackgroundColor3 = Color3.fromRGB(34, 34, 34)
            Toggle.Size = UDim2.new(0, 363, 0, 42)
            Toggle.Text = ""
            Instance.new("UICorner", Toggle).CornerRadius = UDim.new(0, 6)
            
            local ToggleTitle = Instance.new("TextLabel", Toggle)
            ToggleTitle.BackgroundTransparency = 1
            ToggleTitle.Position = UDim2.new(0.035, 0, 0, 0)
            ToggleTitle.Size = UDim2.new(0, 187, 0, 42)
            ToggleTitle.Font = Enum.Font.Gotham
            ToggleTitle.Text = text
            ToggleTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
            ToggleTitle.TextSize = 14
            ToggleTitle.TextXAlignment = Enum.TextXAlignment.Left
            
            local FrameToggle1 = Instance.new("Frame", Toggle)
            FrameToggle1.Name = "FrameToggle1"
            FrameToggle1.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            FrameToggle1.Position = UDim2.new(0.86, 0, 0.28, 0)
            FrameToggle1.Size = UDim2.new(0, 37, 0, 18)
            Instance.new("UICorner", FrameToggle1).CornerRadius = UDim.new(0, 6)
            
            local FrameToggle3 = Instance.new("Frame", FrameToggle1)
            FrameToggle3.Name = "FrameToggle3"
            FrameToggle3.BackgroundColor3 = PresetColor
            FrameToggle3.BackgroundTransparency = 1
            FrameToggle3.Size = UDim2.new(0, 37, 0, 18)
            Instance.new("UICorner", FrameToggle3).CornerRadius = UDim.new(0, 6)
            
            local FrameToggleCircle = Instance.new("Frame", FrameToggle1)
            FrameToggleCircle.Name = "FrameToggleCircle"
            FrameToggleCircle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            FrameToggleCircle.Position = UDim2.new(0.127, 0, 0.222, 0)
            FrameToggleCircle.Size = UDim2.new(0, 10, 0, 10)
            Instance.new("UICorner", FrameToggleCircle).CornerRadius = UDim.new(0, 5)
            
            local function setState(value)
                toggled = value
                ConfigElements[elementId].Value = toggled
                if value then
                    FrameToggle3.BackgroundTransparency = 0
                    FrameToggleCircle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                    FrameToggleCircle.Position = UDim2.new(0.587, 0, 0.222, 0)
                else
                    FrameToggle3.BackgroundTransparency = 1
                    FrameToggleCircle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
                    FrameToggleCircle.Position = UDim2.new(0.127, 0, 0.222, 0)
                end
                pcall(callback, value)
            end
            
            ConfigElements[elementId] = {Type = "Toggle", Value = toggled, LoadValue = setState}
            Toggle.MouseButton1Click:Connect(function() setState(not toggled) end)
            setState(toggled)
            
            Tab.CanvasSize = UDim2.new(0, 0, 0, TabLayout.AbsoluteContentSize.Y)
        end

        function tabcontent:Slider(text, min, max, start, callback)
            globalElementIdCounter = globalElementIdCounter + 1
            local elementId = "Slider_" .. globalElementIdCounter
            local currentValue = start or 0

            local Slider = Instance.new("Frame", Tab)
            Slider.Name = "Slider"
            Slider.BackgroundColor3 = Color3.fromRGB(34, 34, 34)
            Slider.Size = UDim2.new(0, 363, 0, 60)
            Instance.new("UICorner", Slider).CornerRadius = UDim.new(0, 6)
            
            local SliderTitle = Instance.new("TextLabel", Slider)
            SliderTitle.BackgroundTransparency = 1
            SliderTitle.Position = UDim2.new(0.035, 0, 0, 0)
            SliderTitle.Size = UDim2.new(0, 187, 0, 42)
            SliderTitle.Font = Enum.Font.Gotham
            SliderTitle.Text = text
            SliderTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
            SliderTitle.TextSize = 14
            SliderTitle.TextXAlignment = Enum.TextXAlignment.Left
            
            local SliderValue = Instance.new("TextLabel", Slider)
            SliderValue.BackgroundTransparency = 1
            SliderValue.Size = UDim2.new(1, -20, 0.7, 0)
            SliderValue.Font = Enum.Font.Gotham
            SliderValue.TextColor3 = Color3.fromRGB(255, 255, 255)
            SliderValue.TextSize = 14
            SliderValue.TextXAlignment = Enum.TextXAlignment.Right
            
            local SlideFrame = Instance.new("Frame", Slider)
            SlideFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            SlideFrame.Position = UDim2.new(0.034, 0, 0.686, 0)
            SlideFrame.Size = UDim2.new(0, 335, 0, 3)
            Instance.new("UICorner", SlideFrame).CornerRadius = UDim.new(1, 0)
            
            local CurrentValueFrame = Instance.new("Frame", SlideFrame)
            CurrentValueFrame.Name = "CurrentValueFrame"
            CurrentValueFrame.BackgroundColor3 = PresetColor
            CurrentValueFrame.Size = UDim2.new(0, 0, 1, 0)
            Instance.new("UICorner", CurrentValueFrame).CornerRadius = UDim.new(1, 0)
            
            local SlideCircle = Instance.new("ImageButton", SlideFrame)
            SlideCircle.Name = "SlideCircle"
            SlideCircle.BackgroundTransparency = 1
            SlideCircle.Size = UDim2.new(0, 11, 0, 11)
            SlideCircle.Image = "rbxassetid://3570695787"
            SlideCircle.ImageColor3 = PresetColor
            
            local function setValue(value)
                currentValue = value
                local percent = math.clamp((value - min) / (max - min), 0, 1)
                SliderValue.Text = tostring(math.floor(value))
                CurrentValueFrame.Size = UDim2.new(percent, 0, 1, 0)
                SlideCircle.Position = UDim2.new(percent, -6, -1.3, 0)
                ConfigElements[elementId].Value = currentValue
                pcall(callback, value)
            end
            
            local dragging = false
            SlideCircle.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end end)
            SlideCircle.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
            UserInputService.InputChanged:Connect(function(i) 
                if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then 
                    local percent = math.clamp((i.Position.X - SlideFrame.AbsolutePosition.X) / SlideFrame.AbsoluteSize.X, 0, 1)
                    local newValue = math.floor(min + (max - min) * percent + 0.5)
                    setValue(newValue)
                end 
            end)
            
            ConfigElements[elementId] = {Type = "Slider", Value = currentValue, LoadValue = setValue}
            setValue(currentValue)
            
            Tab.CanvasSize = UDim2.new(0, 0, 0, TabLayout.AbsoluteContentSize.Y)
        end
        
        function tabcontent:Dropdown(text, listOrFunction, callback)
            globalElementIdCounter = globalElementIdCounter + 1
            local elementId = "Dropdown_" .. globalElementIdCounter
            local droptog, framesize, itemcount, currentValue = false, 0, 0, nil

            local Dropdown = Instance.new("Frame", Tab)
            Dropdown.BackgroundColor3 = Color3.fromRGB(34, 34, 34)
            Dropdown.ClipsDescendants = true
            Dropdown.Size = UDim2.new(0, 363, 0, 42)
            Instance.new("UICorner", Dropdown).CornerRadius = UDim.new(0, 6)
            
            local DropdownBtn = Instance.new("TextButton", Dropdown)
            DropdownBtn.BackgroundTransparency = 1
            DropdownBtn.Size = UDim2.new(1, 0, 1, 0)
            DropdownBtn.Text = ""
            
            local DropdownTitle = Instance.new("TextLabel", Dropdown)
            DropdownTitle.Name = text
            DropdownTitle.BackgroundTransparency = 1
            DropdownTitle.Position = UDim2.new(0.035, 0, 0, 0)
            DropdownTitle.Size = UDim2.new(0, 300, 0, 42)
            DropdownTitle.Font = Enum.Font.Gotham
            DropdownTitle.Text = text
            DropdownTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
            DropdownTitle.TextSize = 14
            DropdownTitle.TextXAlignment = Enum.TextXAlignment.Left
            
            local ArrowImg = Instance.new("ImageLabel", Dropdown)
            ArrowImg.BackgroundTransparency = 1
            ArrowImg.Position = UDim2.new(1, -36, 0.5, -13)
            ArrowImg.Size = UDim2.new(0, 26, 0, 26)
            ArrowImg.Image = "http://www.roblox.com/asset/?id=6034818375"
            
            local DropItemHolder = Instance.new("ScrollingFrame", Dropdown)
            DropItemHolder.Active = true
            DropItemHolder.BackgroundTransparency = 1
            DropItemHolder.Position = UDim2.new(0.04, 0, 1.1, 0)
            DropItemHolder.Size = UDim2.new(0.92, 0, 0, 0)
            DropItemHolder.ScrollBarThickness = 3
            
            local DropLayout = Instance.new("UIListLayout", DropItemHolder)
            DropLayout.Padding = UDim.new(0, 2)
            
            local dropdownObj = {}
            function dropdownObj.SetText(newText)
                DropdownTitle.Text = newText
            end

            function dropdownObj.Refresh()
                if type(listOrFunction) == "function" then
                    local list = listOrFunction()
                    for _, child in pairs(DropItemHolder:GetChildren()) do if child:IsA("TextButton") then child:Destroy() end end
                    framesize, itemcount = 0, 0
                    if #list == 0 then list = {"No Configs"} end
                    for _, v in pairs(list) do
                        itemcount = itemcount + 1
                        if itemcount <= 3 then framesize = framesize + 26 end
                        local Item = Instance.new("TextButton", DropItemHolder)
                        Item.BackgroundColor3 = Color3.fromRGB(34, 34, 34)
                        Item.Size = UDim2.new(1, 0, 0, 25)
                        Item.Font = Enum.Font.Gotham
                        Item.Text = v
                        Item.TextColor3 = Color3.fromRGB(255, 255, 255)
                        Item.TextSize = 15
                        Instance.new("UICorner", Item).CornerRadius = UDim.new(0, 6)
                        Item.MouseButton1Click:Connect(function()
                            droptog = not droptog
                            DropdownTitle.Text = text .. " - " .. v
                            currentValue = v
                            ConfigElements[elementId].Value = currentValue
                            pcall(callback, v)
                            Dropdown:TweenSize(UDim2.new(0, 363, 0, 42), "Out", "Quart", .2, true)
                            ArrowImg:TweenRotation(0, "Out", "Quart", .2, true)
                            wait(.2)
                            Tab.CanvasSize = UDim2.new(0, 0, 0, TabLayout.AbsoluteContentSize.Y)
                        end)
                    end
                    DropItemHolder.Size = UDim2.new(0.92, 0, 0, framesize)
                    DropItemHolder.CanvasSize = UDim2.new(0, 0, 0, DropLayout.AbsoluteContentSize.Y)
                end
            end

            DropdownBtn.MouseButton1Click:Connect(function()
                if not droptog then
                    dropdownObj.Refresh()
                    Dropdown:TweenSize(UDim2.new(0, 363, 0, 55 + framesize), "Out", "Quart", .2, true)
                    ArrowImg:TweenRotation(270, "Out", "Quart", .2, true)
                else
                    Dropdown:TweenSize(UDim2.new(0, 363, 0, 42), "Out", "Quart", .2, true)
                    ArrowImg:TweenRotation(0, "Out", "Quart", .2, true)
                end
                droptog = not droptog
                wait(.2)
                Tab.CanvasSize = UDim2.new(0, 0, 0, TabLayout.AbsoluteContentSize.Y)
            end)
            
            ConfigElements[elementId] = {Type = "Dropdown", Value = currentValue, LoadValue = function(v)
                currentValue = v
                DropdownTitle.Text = text .. " - " .. tostring(v)
                pcall(callback, v)
            end}

            dropdownObj.Refresh()
            Tab.CanvasSize = UDim2.new(0, 0, 0, TabLayout.AbsoluteContentSize.Y)
            return dropdownObj
        end

        function tabcontent:Label(text)
            local Label = Instance.new("TextLabel", Tab)
            Label.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
            Label.Size = UDim2.new(0, 363, 0, 42)
            Label.Font = Enum.Font.Gotham
            Label.Text = "  " .. text
            Label.TextColor3 = Color3.fromRGB(255, 255, 255)
            Label.TextSize = 14
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Instance.new("UICorner", Label).CornerRadius = UDim.new(0, 6)
            Tab.CanvasSize = UDim2.new(0, 0, 0, TabLayout.AbsoluteContentSize.Y)
        end

        function tabcontent:Textbox(text, disapper, callback)
            globalElementIdCounter = globalElementIdCounter + 1
            local elementId = "Textbox_" .. globalElementIdCounter
            local currentValue = ""

            local Frame = Instance.new("Frame", Tab)
            Frame.BackgroundColor3 = Color3.fromRGB(34, 34, 34)
            Frame.Size = UDim2.new(0, 363, 0, 42)
            Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)
            
            local Title = Instance.new("TextLabel", Frame)
            Title.BackgroundTransparency = 1
            Title.Size = UDim2.new(0.5, 0, 1, 0)
            Title.Position = UDim2.new(0.035, 0, 0, 0)
            Title.Font = Enum.Font.Gotham
            Title.Text = text
            Title.TextColor3 = Color3.fromRGB(255, 255, 255)
            Title.TextSize = 14
            Title.TextXAlignment = Enum.TextXAlignment.Left
            
            local TextboxFrame = Instance.new("Frame", Frame)
            TextboxFrame.BackgroundColor3 = Color3.fromRGB(37, 37, 37)
            TextboxFrame.Position = UDim2.new(1, -110, 0.5, -11.5)
            TextboxFrame.Size = UDim2.new(0, 100, 0, 23)
            Instance.new("UICorner", TextboxFrame).CornerRadius = UDim.new(0, 6)
            
            local Box = Instance.new("TextBox", TextboxFrame)
            Box.BackgroundTransparency = 1
            Box.Size = UDim2.new(1, 0, 1, 0)
            Box.Font = Enum.Font.Gotham
            Box.Text = ""
            Box.TextColor3 = Color3.fromRGB(255, 255, 255)
            Box.TextSize = 14
            
            ConfigElements[elementId] = {Type = "Textbox", Value = currentValue, LoadValue = function(val)
                currentValue = val or ""
                Box.Text = currentValue
                pcall(callback, currentValue)
            end}

            Box:GetPropertyChangedSignal("Text"):Connect(function()
                currentValue = Box.Text
                ConfigElements[elementId].Value = currentValue
                pcall(callback, currentValue)
            end)

            Box.FocusLost:Connect(function(enterPressed)
                if enterPressed and disapper then
                    Box.Text = ""
                    currentValue = ""
                    ConfigElements[elementId].Value = ""
                end
            end)
            
            Tab.CanvasSize = UDim2.new(0, 0, 0, TabLayout.AbsoluteContentSize.Y)
        end
        
        function tabcontent:Bind(text, key, callback)
            globalElementIdCounter = globalElementIdCounter + 1
            local elementId = "Bind_" .. globalElementIdCounter
            local currentKey, binding = key, false

            local Bind = Instance.new("TextButton", Tab)
            Bind.BackgroundColor3 = Color3.fromRGB(34, 34, 34)
            Bind.Size = UDim2.new(0, 363, 0, 42)
            Instance.new("UICorner", Bind).CornerRadius = UDim.new(0, 6)
            
            local Title = Instance.new("TextLabel", Bind)
            Title.BackgroundTransparency = 1
            Title.Size = UDim2.new(0.5, 0, 1, 0)
            Title.Position = UDim2.new(0.035, 0, 0, 0)
            Title.Font = Enum.Font.Gotham
            Title.Text = text
            Title.TextColor3 = Color3.fromRGB(255, 255, 255)
            Title.TextSize = 14
            Title.TextXAlignment = Enum.TextXAlignment.Left
            
            local KeyText = Instance.new("TextLabel", Bind)
            KeyText.BackgroundTransparency = 1
            KeyText.Size = UDim2.new(1, -20, 1, 0)
            KeyText.Font = Enum.Font.Gotham
            KeyText.TextColor3 = Color3.fromRGB(255, 255, 255)
            KeyText.TextSize = 14
            KeyText.TextXAlignment = Enum.TextXAlignment.Right
            
            ConfigElements[elementId] = {Type = "Bind", Value = currentKey.Name, LoadValue = function(val)
                for _, kc in pairs(Enum.KeyCode:GetEnumItems()) do
                    if kc.Name == val then
                        currentKey = kc
                        KeyText.Text = currentKey.Name
                        break
                    end
                end
            end}

            Bind.MouseButton1Click:Connect(function()
                if isMobile then return end
                KeyText.Text = "..."
                binding = true
                local input = UserInputService.InputBegan:wait()
                if input.KeyCode.Name ~= "Unknown" then
                    currentKey = input.KeyCode
                    ConfigElements[elementId].Value = currentKey.Name
                    if text:lower():find("toggle") then
                        lib:SetToggleKey(currentKey)
                    end
                    pcall(callback)
                end
                KeyText.Text = currentKey.Name
                binding = false
            end)

            UserInputService.InputBegan:Connect(function(input, processed)
                if not processed and input.KeyCode == currentKey and not binding then
                    pcall(callback)
                end
            end)
            
            KeyText.Text = currentKey.Name
            Tab.CanvasSize = UDim2.new(0, 0, 0, TabLayout.AbsoluteContentSize.Y)
        end

        return tabcontent
    end
    return tabhold
end

return lib
